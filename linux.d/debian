# if user is root no sudo
if [ "$(id -u)" -eq 0 ]; then
    SUDO=""
else
    SUDO="sudo"
fi

REQUIRED_DEV_PACKAGES=(
    autoconf
    build-essential
    cmake
    eglexternalplatform-dev
    extra-cmake-modules
    file
    gettext
    git
    libcurl4-openssl-dev
    libdbus-1-dev
    libglew-dev
    libgstreamerd-3-dev
    libgtk-3-dev
    libmspack-dev
    libosmesa6-dev
    libsecret-1-dev
    libssl-dev
    libtool
    libudev-dev
    ninja-build
    texinfo
    wget
    libx264-dev
    libusrsctp-dev
    libsrtp2-dev
    libasound2-dev
    libopus-dev
    libspeexdsp-dev
)

if [[ -n "$UPDATE_LIB" ]]
then
    ubu_major_version="$(grep VERSION_ID /etc/os-release | cut -d "=" -f 2 | cut -d "." -f 1 | tr -d /\"/)"
    case ${ubu_major_version} in
        "20"|"21""22"|"23")
            REQUIRED_DEV_PACKAGES+=(libwebkit2gtk-4.0-dev)
            ;;
        "24")
            REQUIRED_DEV_PACKAGES+=(libwebkit2gtk-4.1-dev)
            ;;
        *)
            ;;
    esac

    if [[ -n "$BUILD_DEBUG" ]]
    then
        REQUIRED_DEV_PACKAGES+=(libssl-dev libcurl4-openssl-dev)
    fi
    # TODO: optimize this by checking which, if any, packages are already installed

    # install them all at once
    $SUDO apt update
    $SUDO apt install -y ${REQUIRED_DEV_PACKAGES[@]}

    echo -e "done\n"
    exit 0
fi

FOUND_GTK3=$(dpkg -l libgtk* | grep gtk-3)
FOUND_GTK3_DEV=$(dpkg -l libgtk* | grep gtk-3-dev || echo '')
